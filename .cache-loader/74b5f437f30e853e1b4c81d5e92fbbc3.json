{"remainingRequest":"/Users/gabrielregis/react-spectrum-control-panel/node_modules/thread-loader/dist/cjs.js??ref--7-1!/Users/gabrielregis/react-spectrum-control-panel/node_modules/babel-loader/lib/index.js??ref--7-2!/Users/gabrielregis/react-spectrum-control-panel/src/services/http.ts","dependencies":[{"path":"/Users/gabrielregis/react-spectrum-control-panel/src/services/http.ts","mtime":1560467078000},{"path":"/Users/gabrielregis/react-spectrum-control-panel/node_modules/cache-loader/dist/cjs.js","mtime":1561315137663},{"path":"/Users/gabrielregis/react-spectrum-control-panel/node_modules/thread-loader/dist/cjs.js","mtime":1561315143281},{"path":"/Users/gabrielregis/react-spectrum-control-panel/node_modules/babel-loader/lib/index.js","mtime":1561315137554}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM2LnN5bWJvbCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20uaXRlcmFibGUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lczYucmVnZXhwLnJlcGxhY2UiOwppbXBvcnQgImFudGQvbGliL21lc3NhZ2Uvc3R5bGUiOwppbXBvcnQgX21lc3NhZ2UgZnJvbSAiYW50ZC9saWIvbWVzc2FnZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNi5wcm9taXNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmciOwoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IHZhciBvd25LZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTsgaWYgKHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSAnZnVuY3Rpb24nKSB7IG93bktleXMgPSBvd25LZXlzLmNvbmNhdChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHNvdXJjZSkuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBzeW0pLmVudW1lcmFibGU7IH0pKTsgfSBvd25LZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCAqIGFzIHFzIGZyb20gJ3FzJzsKaW1wb3J0IHsgdXNlckluZm8gfSBmcm9tICdAc3RvcmUvYXV0aFN0b3JlL3N5bmNVc2VySW5mbyc7CnZhciBIVFRQRVJST1I7CgooZnVuY3Rpb24gKEhUVFBFUlJPUikgewogIEhUVFBFUlJPUltIVFRQRVJST1JbIkxPR0lDRVJST1IiXSA9IDBdID0gIkxPR0lDRVJST1IiOwogIEhUVFBFUlJPUltIVFRQRVJST1JbIlRJTUVPVVRFUlJPUiJdID0gMV0gPSAiVElNRU9VVEVSUk9SIjsKICBIVFRQRVJST1JbSFRUUEVSUk9SWyJORVRXT1JLRVJST1IiXSA9IDJdID0gIk5FVFdPUktFUlJPUiI7Cn0pKEhUVFBFUlJPUiB8fCAoSFRUUEVSUk9SID0ge30pKTsKCnZhciBUT0tFTkVSUk9SID0gWzQwMSwgNDAyLCA0MDNdOwp2YXIgREVGQVVMVENPTkZJRyA9IHsKICBiYXNlVVJMOiBwcm9jZXNzLmVudi5CQVNFVVJMCn07CnZhciBodHRwID0ge307CnZhciBtZXRob2RzID0gWydnZXQnLCAncG9zdCcsICdwdXQnLCAnZGVsZXRlJ107CnZhciBhdXRoVGltZXIgPSBudWxsOwoKdmFyIGlzU3VjY2VzcyA9IHJlcyA9PiByZXMuZXJyQ29kZSA9PT0gMDsKCnZhciByZXNGb3JtYXQgPSByZXMgPT4gcmVzLnJlc3BvbnNlIHx8IHJlcy5kYXRhIHx8IHt9OwoKbWV0aG9kcy5mb3JFYWNoKHYgPT4gewogIGh0dHBbdl0gPSAodXJsLCBkYXRhLCBiYXNlVXJsKSA9PiB7CiAgICB2YXIgYXhpb3NDb25maWcgPSB7CiAgICAgIG1ldGhvZDogdiwKICAgICAgdXJsLAogICAgICBiYXNlVVJMOiBiYXNlVXJsIHx8IERFRkFVTFRDT05GSUcuYmFzZVVSTCwKICAgICAgaGVhZGVyczogewogICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt1c2VySW5mby50b2tlbn1gCiAgICAgIH0KICAgIH07CiAgICB2YXIgaW5zdGFuY2UgPSBheGlvcy5jcmVhdGUoREVGQVVMVENPTkZJRyk7IC8vIEFkZCBhIHJlcXVlc3QgaW50ZXJjZXB0b3IKCiAgICBpbnN0YW5jZS5pbnRlcmNlcHRvcnMucmVxdWVzdC51c2UoY2ZnID0+IHsKICAgICAgY2ZnLnBhcmFtcyA9IF9vYmplY3RTcHJlYWQoe30sIGNmZy5wYXJhbXMsIHsKICAgICAgICB0czogRGF0ZS5ub3coKSAvIDEwMDAKICAgICAgfSk7CiAgICAgIHJldHVybiBjZmc7CiAgICB9LCBlcnJvciA9PiBQcm9taXNlLnJlamVjdChlcnJvcikpOyAvLyBBZGQgYSByZXNwb25zZSBpbnRlcmNlcHRvcgoKICAgIGluc3RhbmNlLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UocmVzcG9uc2UgPT4gewogICAgICB2YXIgcmRhdGEgPSB0eXBlb2YgcmVzcG9uc2UuZGF0YSA9PT0gJ29iamVjdCcgJiYgIWlzTmFOKHJlc3BvbnNlLmRhdGEubGVuZ3RoKSA/IHJlc3BvbnNlLmRhdGFbMF0gOiByZXNwb25zZS5kYXRhOwoKICAgICAgaWYgKCFpc1N1Y2Nlc3MocmRhdGEpKSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHsKICAgICAgICAgIG1zZzogcmRhdGEubXNnLAogICAgICAgICAgZXJyQ29kZTogcmRhdGEuZXJyQ29kZSwKICAgICAgICAgIHR5cGU6IEhUVFBFUlJPUltIVFRQRVJST1IuTE9HSUNFUlJPUl0sCiAgICAgICAgICBjb25maWc6IHJlc3BvbnNlLmNvbmZpZwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gcmVzRm9ybWF0KHJkYXRhKTsKICAgIH0sIGVycm9yID0+IHsKICAgICAgaWYgKFRPS0VORVJST1IuaW5jbHVkZXMoZXJyb3IucmVzcG9uc2Uuc3RhdHVzKSkgewogICAgICAgIF9tZXNzYWdlLmRlc3Ryb3koKTsKCiAgICAgICAgX21lc3NhZ2UuZXJyb3IoJ0F1dGhlbnRpY2F0aW9uIGZhaWx1cmUsIFBsZWFzZSByZWxvZ2luIScpOwoKICAgICAgICBjbGVhclRpbWVvdXQoYXV0aFRpbWVyKTsKICAgICAgICBhdXRoVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIGxvY2F0aW9uLnJlcGxhY2UoJy8jL2xvZ2luJyk7CiAgICAgICAgfSwgMzAwKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCh7CiAgICAgICAgbXNnOiBlcnJvci5yZXNwb25zZS5zdGF0dXNUZXh0IHx8IGVycm9yLm1lc3NhZ2UgfHwgJ25ldHdvcmsgZXJyb3InLAogICAgICAgIHR5cGU6IC9edGltZW91dCBvZi8udGVzdChlcnJvci5tZXNzYWdlKSA/IEhUVFBFUlJPUltIVFRQRVJST1IuVElNRU9VVEVSUk9SXSA6IEhUVFBFUlJPUltIVFRQRVJST1IuTkVUV09SS0VSUk9SXSwKICAgICAgICBjb25maWc6IGVycm9yLmNvbmZpZwogICAgICB9KTsKICAgIH0pOwoKICAgIGlmICh2ID09PSAnZ2V0JykgewogICAgICBheGlvc0NvbmZpZy5wYXJhbXMgPSBkYXRhOwogICAgfSBlbHNlIGlmIChkYXRhIGluc3RhbmNlb2YgRm9ybURhdGEpIHsKICAgICAgYXhpb3NDb25maWcuZGF0YSA9IGRhdGE7CiAgICB9IGVsc2UgewogICAgICBheGlvc0NvbmZpZy5kYXRhID0gcXMuc3RyaW5naWZ5KGRhdGEpOwogICAgfQoKICAgIGF4aW9zQ29uZmlnLnN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7CiAgICByZXR1cm4gaW5zdGFuY2UucmVxdWVzdChheGlvc0NvbmZpZykudGhlbihyZXMgPT4gcmVzKS5jYXRjaChlcnIgPT4gewogICAgICBfbWVzc2FnZS5kZXN0cm95KCk7CgogICAgICBfbWVzc2FnZS5lcnJvcihlcnIucmVzcG9uc2UgfHwgZXJyLm1zZyB8fCBlcnIuc3RhY2sgfHwgJ3Vua25vd24gZXJyb3InKTsKCiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChheGlvc0NvbmZpZy51cmwuaW5jbHVkZXMoJ2F1dG9TY3JpcHQuc2V0JykgPyB7CiAgICAgICAgZXJyCiAgICAgIH0gOiB7CiAgICAgICAgZXJyLAogICAgICAgIHN0YWNrOiBlcnIubXNnIHx8IGVyci5zdGFjayB8fCAnJwogICAgICB9KTsKICAgIH0pOwogIH07Cn0pOwpleHBvcnQgZGVmYXVsdCBodHRwOw=="},{"version":3,"sources":["/Users/gabrielregis/react-spectrum-control-panel/src/services/http.ts"],"names":["axios","qs","userInfo","HTTPERROR","TOKENERROR","DEFAULTCONFIG","baseURL","process","env","BASEURL","http","methods","authTimer","isSuccess","res","errCode","resFormat","response","data","forEach","v","url","baseUrl","axiosConfig","method","headers","Authorization","token","instance","create","interceptors","request","use","cfg","params","ts","Date","now","error","Promise","reject","rdata","isNaN","length","msg","type","LOGICERROR","config","includes","status","destroy","clearTimeout","setTimeout","location","replace","statusText","message","test","TIMEOUTERROR","NETWORKERROR","FormData","stringify","startTime","then","catch","err","stack"],"mappings":"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","sourcesContent":["import axios, { AxiosRequestConfig as _AxiosRequestConfig } from 'axios'\nimport * as qs from 'qs'\nimport { message } from 'antd'\n\nimport { userInfo } from '@store/authStore/syncUserInfo'\n\nexport interface AxiosRequestConfig extends _AxiosRequestConfig {\n    startTime?: Date\n}\n\nexport interface HttpResquest {\n    get?(url: string, data: object, baseUrl?: string): Promise<any>\n    post?(url: string, data: object, baseUrl?: string): Promise<any>\n    delete?(url: string, data: object, baseUrl?: string): Promise<any>\n    put?(url: string, data: object, baseUrl?: string): Promise<any>\n}\n\nenum HTTPERROR {\n    LOGICERROR,\n    TIMEOUTERROR,\n    NETWORKERROR\n}\n\nconst TOKENERROR = [401, 402, 403]\n\nconst DEFAULTCONFIG = {\n    baseURL: process.env.BASEURL\n}\n\nconst http: HttpResquest = {}\nconst methods = ['get', 'post', 'put', 'delete']\n\nlet authTimer: NodeJS.Timer = null\n\nconst isSuccess = res => res.errCode === 0\nconst resFormat = res => res.response || res.data || {}\n\nmethods.forEach(v => {\n    http[v] = (url: string, data: object, baseUrl?: string) => {\n        const axiosConfig: AxiosRequestConfig = {\n            method: v,\n            url,\n            baseURL: baseUrl || DEFAULTCONFIG.baseURL,\n            headers: { Authorization: `Bearer ${userInfo.token}` }\n        }\n        const instance = axios.create(DEFAULTCONFIG)\n        // Add a request interceptor\n        instance.interceptors.request.use(\n            cfg => {\n                cfg.params = { ...cfg.params, ts: Date.now() / 1000 }\n                return cfg\n            },\n            error => Promise.reject(error)\n        )\n        // Add a response interceptor\n        instance.interceptors.response.use(\n            response => {\n                const rdata =\n                    typeof response.data === 'object' && !isNaN(response.data.length) ? response.data[0] : response.data\n                if (!isSuccess(rdata)) {\n                    return Promise.reject({\n                        msg: rdata.msg,\n                        errCode: rdata.errCode,\n                        type: HTTPERROR[HTTPERROR.LOGICERROR],\n                        config: response.config\n                    })\n                }\n                return resFormat(rdata)\n            },\n            error => {\n                if (TOKENERROR.includes(error.response.status)) {\n                    message.destroy()\n                    message.error('Authentication failure, Please relogin!')\n                    clearTimeout(authTimer)\n                    authTimer = setTimeout(() => {\n                        location.replace('/#/login')\n                    }, 300)\n                    return\n                }\n                return Promise.reject({\n                    msg: error.response.statusText || error.message || 'network error',\n                    type: /^timeout of/.test(error.message)\n                        ? HTTPERROR[HTTPERROR.TIMEOUTERROR]\n                        : HTTPERROR[HTTPERROR.NETWORKERROR],\n                    config: error.config\n                })\n            }\n        )\n        if (v === 'get') {\n            axiosConfig.params = data\n        } else if (data instanceof FormData) {\n            axiosConfig.data = data\n        } else {\n            axiosConfig.data = qs.stringify(data)\n        }\n        axiosConfig.startTime = new Date()\n        return instance\n            .request(axiosConfig)\n            .then(res => res)\n            .catch(err => {\n                message.destroy()\n                message.error(err.response || err.msg || err.stack || 'unknown error')\n                return Promise.reject(\n                    axiosConfig.url.includes('autoScript.set') ? { err } : { err, stack: err.msg || err.stack || '' }\n                )\n            })\n    }\n})\n\nexport default http\n"]}]}